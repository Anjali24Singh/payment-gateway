<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ApplicationConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">payment-gateway</a> &gt; <a href="index.source.html" class="el_package">com.talentica.paymentgateway.config</a> &gt; <span class="el_source">ApplicationConfig.java</span></div><h1>ApplicationConfig.java</h1><pre class="source lang-java linenums">package com.talentica.paymentgateway.config;

import io.micrometer.core.aop.TimedAspect;
import io.micrometer.core.instrument.MeterRegistry;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.connection.RedisConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;
import org.springframework.data.redis.serializer.StringRedisSerializer;
import org.springframework.scheduling.annotation.EnableAsync;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;
import org.springframework.web.client.RestTemplate;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;

import java.util.Arrays;
import java.util.concurrent.Executor;

/**
 * Main application configuration class.
 * Configures core application beans and settings.
 * 
 * @author Payment Gateway Team
 * @version 1.0.0
 */
@Configuration
@EnableAsync
@EnableConfigurationProperties(ApplicationConfig.AppProperties.class)
<span class="fc" id="L35">public class ApplicationConfig {</span>

    /**
     * Configure async task executor for background processing.
     * 
     * @return Configured thread pool task executor
     */
    @Bean(name = &quot;taskExecutor&quot;)
    public Executor taskExecutor() {
<span class="fc" id="L44">        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();</span>
<span class="fc" id="L45">        executor.setCorePoolSize(5);</span>
<span class="fc" id="L46">        executor.setMaxPoolSize(20);</span>
<span class="fc" id="L47">        executor.setQueueCapacity(100);</span>
<span class="fc" id="L48">        executor.setKeepAliveSeconds(60);</span>
<span class="fc" id="L49">        executor.setThreadNamePrefix(&quot;PaymentGateway-Async-&quot;);</span>
<span class="fc" id="L50">        executor.setWaitForTasksToCompleteOnShutdown(true);</span>
<span class="fc" id="L51">        executor.setAwaitTerminationSeconds(30);</span>
<span class="fc" id="L52">        executor.initialize();</span>
<span class="fc" id="L53">        return executor;</span>
    }

    /**
     * Configure CORS for cross-origin requests.
     * 
     * @return CORS configuration source
     */
    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
<span class="fc" id="L63">        CorsConfiguration configuration = new CorsConfiguration();</span>
<span class="fc" id="L64">        configuration.setAllowedOriginPatterns(Arrays.asList(&quot;*&quot;));</span>
<span class="fc" id="L65">        configuration.setAllowedMethods(Arrays.asList(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;, &quot;PATCH&quot;));</span>
<span class="fc" id="L66">        configuration.setAllowedHeaders(Arrays.asList(&quot;*&quot;));</span>
<span class="fc" id="L67">        configuration.setAllowCredentials(true);</span>
<span class="fc" id="L68">        configuration.setMaxAge(3600L);</span>
        
<span class="fc" id="L70">        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();</span>
<span class="fc" id="L71">        source.registerCorsConfiguration(&quot;/**&quot;, configuration);</span>
<span class="fc" id="L72">        return source;</span>
    }

    /**
     * Configure timed aspect for method execution metrics.
     * 
     * @param registry Micrometer meter registry
     * @return Timed aspect for AOP
     */
    @Bean
    public TimedAspect timedAspect(MeterRegistry registry) {
<span class="fc" id="L83">        return new TimedAspect(registry);</span>
    }

    /**
     * Configure RestTemplate for webhook delivery.
     * 
     * @return Configured RestTemplate with timeout settings
     */
    @Bean
    public RestTemplate restTemplate() {
<span class="fc" id="L93">        RestTemplate restTemplate = new RestTemplate();</span>
        
        // Configure timeout settings for webhook requests
<span class="fc" id="L96">        restTemplate.getRequestFactory().toString(); // This creates the default factory</span>
        
<span class="fc" id="L98">        return restTemplate;</span>
    }

    /**
     * Configure Redis template for caching and rate limiting.
     * 
     * @param connectionFactory Redis connection factory
     * @return Configured Redis template
     */
    @Bean
    @ConditionalOnClass(RedisTemplate.class)
    @ConditionalOnBean(RedisConnectionFactory.class)
    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory connectionFactory) {
<span class="fc" id="L111">        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();</span>
<span class="fc" id="L112">        template.setConnectionFactory(connectionFactory);</span>
        
        // Configure serializers
<span class="fc" id="L115">        template.setKeySerializer(new StringRedisSerializer());</span>
<span class="fc" id="L116">        template.setHashKeySerializer(new StringRedisSerializer());</span>
<span class="fc" id="L117">        template.setValueSerializer(new GenericJackson2JsonRedisSerializer());</span>
<span class="fc" id="L118">        template.setHashValueSerializer(new GenericJackson2JsonRedisSerializer());</span>
        
<span class="fc" id="L120">        template.afterPropertiesSet();</span>
<span class="fc" id="L121">        return template;</span>
    }

    /**
     * Application properties configuration.
     */
    @ConfigurationProperties(prefix = &quot;app&quot;)
<span class="fc" id="L128">    public static class AppProperties {</span>
        private String name;
        private String version;
        private String description;
<span class="fc" id="L132">        private Jwt jwt = new Jwt();</span>
<span class="fc" id="L133">        private RateLimit rateLimit = new RateLimit();</span>
<span class="fc" id="L134">        private Correlation correlation = new Correlation();</span>
<span class="fc" id="L135">        private Webhook webhook = new Webhook();</span>
<span class="fc" id="L136">        private Payment payment = new Payment();</span>
<span class="fc" id="L137">        private AuthorizeNet authorizeNet = new AuthorizeNet();</span>
<span class="fc" id="L138">        private Cors cors = new Cors();</span>

        // Getters and setters
<span class="nc" id="L141">        public String getName() { return name; }</span>
<span class="fc" id="L142">        public void setName(String name) { this.name = name; }</span>

<span class="nc" id="L144">        public String getVersion() { return version; }</span>
<span class="fc" id="L145">        public void setVersion(String version) { this.version = version; }</span>

<span class="nc" id="L147">        public String getDescription() { return description; }</span>
<span class="fc" id="L148">        public void setDescription(String description) { this.description = description; }</span>

<span class="fc" id="L150">        public Jwt getJwt() { return jwt; }</span>
<span class="fc" id="L151">        public void setJwt(Jwt jwt) { this.jwt = jwt; }</span>

<span class="fc" id="L153">        public RateLimit getRateLimit() { return rateLimit; }</span>
<span class="fc" id="L154">        public void setRateLimit(RateLimit rateLimit) { this.rateLimit = rateLimit; }</span>

<span class="fc" id="L156">        public Correlation getCorrelation() { return correlation; }</span>
<span class="fc" id="L157">        public void setCorrelation(Correlation correlation) { this.correlation = correlation; }</span>

<span class="fc" id="L159">        public Webhook getWebhook() { return webhook; }</span>
<span class="fc" id="L160">        public void setWebhook(Webhook webhook) { this.webhook = webhook; }</span>

<span class="fc" id="L162">        public Payment getPayment() { return payment; }</span>
<span class="fc" id="L163">        public void setPayment(Payment payment) { this.payment = payment; }</span>

<span class="fc" id="L165">        public AuthorizeNet getAuthorizeNet() { return authorizeNet; }</span>
<span class="fc" id="L166">        public void setAuthorizeNet(AuthorizeNet authorizeNet) { this.authorizeNet = authorizeNet; }</span>

<span class="nc" id="L168">        public Cors getCors() { return cors; }</span>
<span class="nc" id="L169">        public void setCors(Cors cors) { this.cors = cors; }</span>

<span class="fc" id="L171">        public static class Jwt {</span>
            private String secret;
            private long expiration;
            private long refreshExpiration;

<span class="fc" id="L176">            public String getSecret() { return secret; }</span>
<span class="fc" id="L177">            public void setSecret(String secret) { this.secret = secret; }</span>

<span class="fc" id="L179">            public long getExpiration() { return expiration; }</span>
<span class="fc" id="L180">            public void setExpiration(long expiration) { this.expiration = expiration; }</span>

<span class="fc" id="L182">            public long getRefreshExpiration() { return refreshExpiration; }</span>
<span class="fc" id="L183">            public void setRefreshExpiration(long refreshExpiration) { this.refreshExpiration = refreshExpiration; }</span>
        }

<span class="fc" id="L186">        public static class RateLimit {</span>
            private boolean enabled;
            private int defaultLimit;
            private int burstLimit;

<span class="fc" id="L191">            public boolean isEnabled() { return enabled; }</span>
<span class="fc" id="L192">            public void setEnabled(boolean enabled) { this.enabled = enabled; }</span>

<span class="fc" id="L194">            public int getDefaultLimit() { return defaultLimit; }</span>
<span class="fc" id="L195">            public void setDefaultLimit(int defaultLimit) { this.defaultLimit = defaultLimit; }</span>

<span class="fc" id="L197">            public int getBurstLimit() { return burstLimit; }</span>
<span class="fc" id="L198">            public void setBurstLimit(int burstLimit) { this.burstLimit = burstLimit; }</span>
        }

<span class="fc" id="L201">        public static class Correlation {</span>
            private String headerName;
            private String mdcKey;

<span class="fc" id="L205">            public String getHeaderName() { return headerName; }</span>
<span class="fc" id="L206">            public void setHeaderName(String headerName) { this.headerName = headerName; }</span>

<span class="fc" id="L208">            public String getMdcKey() { return mdcKey; }</span>
<span class="fc" id="L209">            public void setMdcKey(String mdcKey) { this.mdcKey = mdcKey; }</span>
        }

<span class="fc" id="L212">        public static class Webhook {</span>
<span class="fc" id="L213">            private Retry retry = new Retry();</span>
            private long timeout;

<span class="fc" id="L216">            public Retry getRetry() { return retry; }</span>
<span class="fc" id="L217">            public void setRetry(Retry retry) { this.retry = retry; }</span>

<span class="nc" id="L219">            public long getTimeout() { return timeout; }</span>
<span class="fc" id="L220">            public void setTimeout(long timeout) { this.timeout = timeout; }</span>

<span class="fc" id="L222">            public static class Retry {</span>
                private int maxAttempts;
                private long initialDelay;
                private long maxDelay;
                private double multiplier;

<span class="nc" id="L228">                public int getMaxAttempts() { return maxAttempts; }</span>
<span class="fc" id="L229">                public void setMaxAttempts(int maxAttempts) { this.maxAttempts = maxAttempts; }</span>

<span class="nc" id="L231">                public long getInitialDelay() { return initialDelay; }</span>
<span class="nc" id="L232">                public void setInitialDelay(long initialDelay) { this.initialDelay = initialDelay; }</span>

<span class="nc" id="L234">                public long getMaxDelay() { return maxDelay; }</span>
<span class="nc" id="L235">                public void setMaxDelay(long maxDelay) { this.maxDelay = maxDelay; }</span>

<span class="nc" id="L237">                public double getMultiplier() { return multiplier; }</span>
<span class="fc" id="L238">                public void setMultiplier(double multiplier) { this.multiplier = multiplier; }</span>
            }
        }

<span class="fc" id="L242">        public static class Payment {</span>
            private long timeout;
<span class="fc" id="L244">            private Retry retry = new Retry();</span>

<span class="nc" id="L246">            public long getTimeout() { return timeout; }</span>
<span class="fc" id="L247">            public void setTimeout(long timeout) { this.timeout = timeout; }</span>

<span class="fc" id="L249">            public Retry getRetry() { return retry; }</span>
<span class="fc" id="L250">            public void setRetry(Retry retry) { this.retry = retry; }</span>

<span class="fc" id="L252">            public static class Retry {</span>
                private int maxAttempts;
                private long delay;

<span class="nc" id="L256">                public int getMaxAttempts() { return maxAttempts; }</span>
<span class="fc" id="L257">                public void setMaxAttempts(int maxAttempts) { this.maxAttempts = maxAttempts; }</span>

<span class="nc" id="L259">                public long getDelay() { return delay; }</span>
<span class="fc" id="L260">                public void setDelay(long delay) { this.delay = delay; }</span>
            }
        }

<span class="fc" id="L264">        public static class AuthorizeNet {</span>
            private String environment;
            private String apiLoginId;
            private String transactionKey;
            private String baseUrl;

<span class="nc" id="L270">            public String getEnvironment() { return environment; }</span>
<span class="fc" id="L271">            public void setEnvironment(String environment) { this.environment = environment; }</span>

<span class="nc" id="L273">            public String getApiLoginId() { return apiLoginId; }</span>
<span class="fc" id="L274">            public void setApiLoginId(String apiLoginId) { this.apiLoginId = apiLoginId; }</span>

<span class="nc" id="L276">            public String getTransactionKey() { return transactionKey; }</span>
<span class="fc" id="L277">            public void setTransactionKey(String transactionKey) { this.transactionKey = transactionKey; }</span>

<span class="nc" id="L279">            public String getBaseUrl() { return baseUrl; }</span>
<span class="fc" id="L280">            public void setBaseUrl(String baseUrl) { this.baseUrl = baseUrl; }</span>
        }

<span class="fc" id="L283">        public static class Cors {</span>
            private String[] allowedOrigins;
            private String allowedMethods;
            private String allowedHeaders;
            private boolean allowCredentials;
            private long maxAge;

<span class="nc" id="L290">            public String[] getAllowedOrigins() { return allowedOrigins; }</span>
<span class="nc" id="L291">            public void setAllowedOrigins(String[] allowedOrigins) { this.allowedOrigins = allowedOrigins; }</span>

<span class="nc" id="L293">            public String getAllowedMethods() { return allowedMethods; }</span>
<span class="nc" id="L294">            public void setAllowedMethods(String allowedMethods) { this.allowedMethods = allowedMethods; }</span>

<span class="nc" id="L296">            public String getAllowedHeaders() { return allowedHeaders; }</span>
<span class="nc" id="L297">            public void setAllowedHeaders(String allowedHeaders) { this.allowedHeaders = allowedHeaders; }</span>

<span class="nc" id="L299">            public boolean isAllowCredentials() { return allowCredentials; }</span>
<span class="nc" id="L300">            public void setAllowCredentials(boolean allowCredentials) { this.allowCredentials = allowCredentials; }</span>

<span class="nc" id="L302">            public long getMaxAge() { return maxAge; }</span>
<span class="nc" id="L303">            public void setMaxAge(long maxAge) { this.maxAge = maxAge; }</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>