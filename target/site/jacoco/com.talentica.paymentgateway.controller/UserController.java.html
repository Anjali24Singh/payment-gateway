<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UserController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">payment-gateway</a> &gt; <a href="index.source.html" class="el_package">com.talentica.paymentgateway.controller</a> &gt; <span class="el_source">UserController.java</span></div><h1>UserController.java</h1><pre class="source lang-java linenums">package com.talentica.paymentgateway.controller;

import com.talentica.paymentgateway.dto.user.UpdateUserRequest;
import com.talentica.paymentgateway.dto.user.UserResponse;
import com.talentica.paymentgateway.service.UserService;
import jakarta.validation.Valid;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

import java.util.UUID;

/**
 * REST Controller for user management operations.
 * Provides endpoints for CRUD operations on user accounts.
 * 
 * @author Payment Gateway Team
 * @version 1.0.0
 */
<span class="fc" id="L25">@Slf4j</span>
@RestController
@RequestMapping(&quot;/users&quot;)
@CrossOrigin(origins = &quot;*&quot;, maxAge = 3600)
public class UserController {

    private final UserService userService;

<span class="fc" id="L33">    public UserController(UserService userService) {</span>
<span class="fc" id="L34">        this.userService = userService;</span>
<span class="fc" id="L35">    }</span>

    /**
     * Get current user profile information.
     * 
     * @return UserResponse with current user details
     */
    @GetMapping(&quot;/profile&quot;)
    @PreAuthorize(&quot;hasAnyRole('USER', 'ADMIN', 'MERCHANT')&quot;)
    public ResponseEntity&lt;UserResponse&gt; getCurrentUserProfile() {
<span class="fc" id="L45">        log.info(&quot;Getting current user profile&quot;);</span>
<span class="fc" id="L46">        UserResponse userResponse = userService.getCurrentUserProfile();</span>
<span class="fc" id="L47">        return ResponseEntity.ok(userResponse);</span>
    }

    /**
     * Update current user profile.
     * 
     * @param updateRequest the update request
     * @return updated UserResponse
     */
    @PutMapping(&quot;/profile&quot;)
    @PreAuthorize(&quot;hasAnyRole('USER', 'ADMIN', 'MERCHANT')&quot;)
    public ResponseEntity&lt;UserResponse&gt; updateCurrentUserProfile(@Valid @RequestBody UpdateUserRequest updateRequest) {
<span class="fc" id="L59">        log.info(&quot;Updating current user profile: {}&quot;, updateRequest);</span>
<span class="fc" id="L60">        UserResponse updatedUser = userService.updateCurrentUserProfile(updateRequest);</span>
<span class="fc" id="L61">        return ResponseEntity.ok(updatedUser);</span>
    }

    /**
     * Get user by ID (Admin only).
     * 
     * @param userId the user ID
     * @return UserResponse with user details
     */
    @GetMapping(&quot;/{userId}&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN')&quot;)
    public ResponseEntity&lt;UserResponse&gt; getUserById(@PathVariable UUID userId) {
<span class="fc" id="L73">        log.info(&quot;Getting user by ID: {}&quot;, userId);</span>
<span class="fc" id="L74">        UserResponse userResponse = userService.getUserById(userId);</span>
<span class="fc" id="L75">        return ResponseEntity.ok(userResponse);</span>
    }

    /**
     * Update user by ID (Admin only).
     * 
     * @param userId the user ID
     * @param updateRequest the update request
     * @return updated UserResponse
     */
    @PutMapping(&quot;/{userId}&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN')&quot;)
    public ResponseEntity&lt;UserResponse&gt; updateUserById(@PathVariable UUID userId, 
                                                      @Valid @RequestBody UpdateUserRequest updateRequest) {
<span class="fc" id="L89">        log.info(&quot;Updating user {} with data: {}&quot;, userId, updateRequest);</span>
<span class="fc" id="L90">        UserResponse updatedUser = userService.updateUserById(userId, updateRequest);</span>
<span class="fc" id="L91">        return ResponseEntity.ok(updatedUser);</span>
    }

    /**
     * Update user role (Admin only).
     * 
     * @param userId the user ID
     * @param role the new role
     * @return updated UserResponse
     */
    @PutMapping(&quot;/{userId}/role&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN')&quot;)
    public ResponseEntity&lt;UserResponse&gt; updateUserRole(@PathVariable UUID userId, 
                                                      @RequestParam String role) {
<span class="fc" id="L105">        log.info(&quot;Updating user {} role to: {}&quot;, userId, role);</span>
<span class="fc" id="L106">        UserResponse updatedUser = userService.updateUserRole(userId, role);</span>
<span class="fc" id="L107">        return ResponseEntity.ok(updatedUser);</span>
    }

    /**
     * Activate/Deactivate user (Admin only).
     * 
     * @param userId the user ID
     * @param isActive the active status
     * @return updated UserResponse
     */
    @PutMapping(&quot;/{userId}/status&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN')&quot;)
    public ResponseEntity&lt;UserResponse&gt; updateUserStatus(@PathVariable UUID userId, 
                                                        @RequestParam Boolean isActive) {
<span class="fc" id="L121">        log.info(&quot;Updating user {} status to: {}&quot;, userId, isActive);</span>
<span class="fc" id="L122">        UserResponse updatedUser = userService.updateUserStatus(userId, isActive);</span>
<span class="fc" id="L123">        return ResponseEntity.ok(updatedUser);</span>
    }

    /**
     * Get all users with pagination (Admin only).
     * 
     * @param page page number (0-based)
     * @param size page size
     * @param sortBy field to sort by
     * @param sortDir sort direction (asc/desc)
     * @return paginated list of users
     */
    @GetMapping
    @PreAuthorize(&quot;hasRole('ADMIN')&quot;)
    public ResponseEntity&lt;Page&lt;UserResponse&gt;&gt; getAllUsers(
            @RequestParam(defaultValue = &quot;0&quot;) int page,
            @RequestParam(defaultValue = &quot;10&quot;) int size,
            @RequestParam(defaultValue = &quot;createdAt&quot;) String sortBy,
            @RequestParam(defaultValue = &quot;desc&quot;) String sortDir) {
        
<span class="fc" id="L143">        log.info(&quot;Getting all users - page: {}, size: {}, sortBy: {}, sortDir: {}&quot;, </span>
<span class="fc" id="L144">                   page, size, sortBy, sortDir);</span>
        
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">        Sort.Direction direction = sortDir.equalsIgnoreCase(&quot;desc&quot;) ? </span>
<span class="pc" id="L147">                                  Sort.Direction.DESC : Sort.Direction.ASC;</span>
<span class="fc" id="L148">        Pageable pageable = PageRequest.of(page, size, Sort.by(direction, sortBy));</span>
        
<span class="fc" id="L150">        Page&lt;UserResponse&gt; users = userService.getAllUsers(pageable);</span>
<span class="fc" id="L151">        return ResponseEntity.ok(users);</span>
    }

    /**
     * Search users by email or name (Admin only).
     * 
     * @param query search query
     * @param page page number (0-based)
     * @param size page size
     * @return paginated search results
     */
    @GetMapping(&quot;/search&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN')&quot;)
    public ResponseEntity&lt;Page&lt;UserResponse&gt;&gt; searchUsers(
            @RequestParam String query,
            @RequestParam(defaultValue = &quot;0&quot;) int page,
            @RequestParam(defaultValue = &quot;10&quot;) int size) {
        
<span class="fc" id="L169">        log.info(&quot;Searching users with query: '{}' - page: {}, size: {}&quot;, query, page, size);</span>
        
<span class="fc" id="L171">        Pageable pageable = PageRequest.of(page, size, Sort.by(Sort.Direction.DESC, &quot;createdAt&quot;));</span>
<span class="fc" id="L172">        Page&lt;UserResponse&gt; users = userService.searchUsers(query, pageable);</span>
<span class="fc" id="L173">        return ResponseEntity.ok(users);</span>
    }

    /**
     * Delete user (Admin only).
     * 
     * @param userId the user ID
     * @return success response
     */
    @DeleteMapping(&quot;/{userId}&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN')&quot;)
    public ResponseEntity&lt;Void&gt; deleteUser(@PathVariable UUID userId) {
<span class="fc" id="L185">        log.info(&quot;Deleting user: {}&quot;, userId);</span>
<span class="fc" id="L186">        userService.deleteUser(userId);</span>
<span class="fc" id="L187">        return ResponseEntity.noContent().build();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>