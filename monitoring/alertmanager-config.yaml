global:
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'alerts@payment-gateway.com'
  smtp_auth_username: 'alerts@payment-gateway.com'
  smtp_auth_password: 'your-smtp-password'
  slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'

route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'default'
  routes:
  # Critical alerts go to PagerDuty and Slack
  - match:
      severity: critical
    receiver: 'critical-alerts'
    group_wait: 0s
    repeat_interval: 5m
  
  # Payment-specific alerts
  - match:
      category: business
    receiver: 'business-alerts'
    group_by: ['alertname']
    repeat_interval: 30m
  
  # Security alerts
  - match:
      category: security
    receiver: 'security-alerts'
    group_by: ['alertname']
    repeat_interval: 15m
  
  # Database alerts
  - match:
      category: database
    receiver: 'database-alerts'
    group_by: ['alertname']
    repeat_interval: 15m

receivers:
- name: 'default'
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
    channel: '#alerts'
    title: 'Payment Gateway Alert'
    text: |
      {{ range .Alerts }}
      Alert: {{ .Annotations.summary }}
      Description: {{ .Annotations.description }}
      {{ end }}
    send_resolved: true

- name: 'critical-alerts'
  pagerduty_configs:
  - routing_key: 'your-pagerduty-integration-key'
    description: '{{ .CommonAnnotations.summary }}'
    details:
      firing: '{{ .Alerts.Firing | len }}'
      resolved: '{{ .Alerts.Resolved | len }}'
      service: '{{ .CommonLabels.service }}'
      severity: '{{ .CommonLabels.severity }}'
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
    channel: '#critical-alerts'
    title: 'ðŸš¨ CRITICAL: Payment Gateway Alert'
    color: 'danger'
    text: |
      {{ range .Alerts }}
      *Alert:* {{ .Annotations.summary }}
      *Description:* {{ .Annotations.description }}
      *Severity:* {{ .Labels.severity }}
      *Service:* {{ .Labels.service }}
      {{ if .Annotations.runbook_url }}*Runbook:* {{ .Annotations.runbook_url }}{{ end }}
      {{ end }}
    send_resolved: true
    actions:
    - type: button
      text: 'View Dashboard'
      url: 'https://grafana.payment-gateway.com/d/payment-gateway'
    - type: button
      text: 'View Logs'
      url: 'https://kibana.payment-gateway.com'

- name: 'business-alerts'
  email_configs:
  - to: 'business-team@payment-gateway.com'
    subject: 'Payment Gateway Business Alert: {{ .CommonAnnotations.summary }}'
    body: |
      Alert Details:
      {{ range .Alerts }}
      Alert: {{ .Annotations.summary }}
      Description: {{ .Annotations.description }}
      Time: {{ .StartsAt }}
      {{ end }}
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
    channel: '#business-alerts'
    title: 'ðŸ’° Business Alert: Payment Gateway'
    color: 'warning'
    text: |
      {{ range .Alerts }}
      *Alert:* {{ .Annotations.summary }}
      *Description:* {{ .Annotations.description }}
      {{ end }}

- name: 'security-alerts'
  email_configs:
  - to: 'security-team@payment-gateway.com'
    subject: 'SECURITY ALERT: Payment Gateway - {{ .CommonAnnotations.summary }}'
    body: |
      SECURITY ALERT - Immediate attention required
      
      {{ range .Alerts }}
      Alert: {{ .Annotations.summary }}
      Description: {{ .Annotations.description }}
      Time: {{ .StartsAt }}
      Service: {{ .Labels.service }}
      {{ end }}
      
      Please investigate immediately and follow security incident response procedures.
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
    channel: '#security-alerts'
    title: 'ðŸ”’ SECURITY ALERT: Payment Gateway'
    color: 'danger'
    text: |
      {{ range .Alerts }}
      *Alert:* {{ .Annotations.summary }}
      *Description:* {{ .Annotations.description }}
      *Category:* {{ .Labels.category }}
      {{ end }}

- name: 'database-alerts'
  email_configs:
  - to: 'dba-team@payment-gateway.com'
    subject: 'Database Alert: Payment Gateway - {{ .CommonAnnotations.summary }}'
    body: |
      Database Alert for Payment Gateway
      
      {{ range .Alerts }}
      Alert: {{ .Annotations.summary }}
      Description: {{ .Annotations.description }}
      Time: {{ .StartsAt }}
      {{ end }}
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
    channel: '#database-alerts'
    title: 'ðŸ’¾ Database Alert: Payment Gateway'
    color: 'warning'
    text: |
      {{ range .Alerts }}
      *Alert:* {{ .Annotations.summary }}
      *Description:* {{ .Annotations.description }}
      {{ end }}

inhibit_rules:
- source_match:
    severity: 'critical'
  target_match:
    severity: 'warning'
  equal: ['alertname', 'service', 'instance']

- source_match:
    alertname: 'PaymentGatewayDown'
  target_match_re:
    alertname: 'PaymentGateway.*'
  equal: ['instance']
